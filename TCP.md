### 基础知识
TCP是可靠连接，三次握手建立通信，每次发送接收都有反馈，最后四次挥手断开连接。  
通信有标志位，标志通信包，还有序号，给每个字节编码，还有确认号，表示上次已接受，下次需要发送的序号  
初始序号是系统根据时间产生的，双方的序号是独立产生的  
TCP是全双工的，通信双方可以同时发送消息  
常见标志位：SYN，表示请求连接，ACK，表示已收到，FIN，表示完成连接  
11种状态：通信双方通过各自的各种状态，来表明通信的状态  
- CLOSED，通信结束或未开始  
- LISTEN，监听，等待对方连接  
- SYN_SENT，已请求建立连接  
- SYN_RCVD，建立连接请求已收到  
- ESTABLISHED，连接已经建立  
- FIN_WAIT_1，已请求断开连接  
- CLOSE_WAIT，对方请求关闭连接，等待关闭连接  
- FIN_WAIT_2，已收到对方发送的断开确认  
- LAST_ACK，等待最后一个确认关闭回复  
- TIME_WAIT，等待超时后关闭连接  
- CLOSING，双方都请求关闭，等待双方进入TIME_WAIT，超时即断开连接  
### 三次握手
过程：  
A→B：请求通话，A进入SYN_SENT状态，B收到后进入SYN_RCVD状态  
B→A：收到，你能听到我说话吗，A收到后进入ESTABLISHED状态，假设A发送时序号seq为x，则B回复ack为x+1  
A→B：收到，请讲，B也进入ABLISHED状态。假设B发送时序号为y，则A回复ack为y+1，序号seq为x+1  
这样双方都已确认对方能收到自己的消息  
### 四次挥手
过程：
A→B：请求关闭连接，A进入FIN_WAIT_1  
B→A：收到，B立即发送ACK消息，A收到后进入FIN_WAIT_2，若A先收到B发送的FIN消息，则A进入CLOSING状态  
中间B可能需要完成一些待发送的数据。。。  
B→A：B完成数据传递，B进入CLOSE_WAIT，B发送FIN消息进入LAST_ACK  
A→B：可以关闭了，A发送ACK消息后进入TIME_WAIT状态，B收到后进入CLOSED状态，A等待超时进入该状态  
A需要等待2MSL（报文最大生存期），以确保ACK发送给B，而不需要重发  
双方同时发送FIN消息请求关闭连接时，都先收到对方的FIN消息，而不是ACK  
这时，双方进入CLOSING状态，发送ACK后进入TIME_WAIT状态，等待超时关闭  